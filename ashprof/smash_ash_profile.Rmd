---
title: "ASH profiling in SMASH"
output: html_document
---

Tests the three optimization methods in ASH: "mixEM", "cxxMixSquarem" and "mixIP"

```{r}
library(SMASH)

load("data.Robj")

wd = smash:::titable(X.s)$difftable
wv = smash:::titable(sigma.t^2)$sumtable

scale = 10

time.em = matrix(0, nr = 100, nc = 2)
time.squarem = matrix(0, nr = 100, nc = 2)
time.ip = matrix(0, nr = 100, nc = 2)
for(i in 1:100){
  time.em[i, ] = system.time(ash(wd[scale, ], sqrt(wv[scale, ]), prior = "nullbiased", optmethod = "mixEM", pointmass = TRUE, nullcheck = TRUE, mixsd = NULL, mixcompdist = "normal", gridmult = 2, df = NULL))[1:2]
  time.squarem[i, ] = system.time(ash(wd[scale, ], sqrt(wv[scale, ]), prior = "nullbiased", optmethod = "cxxMixSquarem", pointmass = TRUE, nullcheck = TRUE, mixsd = NULL, mixcompdist = "normal", gridmult = 2, df = NULL))[1:2]
  time.ip[i, ] = system.time(ash(wd[scale, ], sqrt(wv[scale, ]), prior = "nullbiased", optmethod = "mixIP", pointmass = TRUE, nullcheck = TRUE, mixsd = NULL, mixcompdist = "normal", gridmult = 2, df = NULL))[1:2]
}

summary(time.em)
summary(time.squarem)
summary(time.ip)

scale = 2

time.em = matrix(0, nr = 100, nc = 2)
time.squarem = matrix(0, nr = 100, nc = 2)
time.ip = matrix(0, nr = 100, nc = 2)
for(i in 1:100){
  time.em[i, ] = system.time(ash(wd[scale, ], sqrt(wv[scale, ]), prior = "nullbiased", optmethod = "mixEM", pointmass = TRUE, nullcheck = TRUE, mixsd = NULL, mixcompdist = "normal", gridmult = 2, df = NULL))[1:2]
  time.squarem[i, ] = system.time(ash(wd[scale, ], sqrt(wv[scale, ]), prior = "nullbiased", optmethod = "cxxMixSquarem", pointmass = TRUE, nullcheck = TRUE, mixsd = NULL, mixcompdist = "normal", gridmult = 2, df = NULL))[1:2]
  time.ip[i, ] = system.time(ash(wd[scale, ], sqrt(wv[scale, ]), prior = "nullbiased", optmethod = "mixIP", pointmass = TRUE, nullcheck = TRUE, mixsd = NULL, mixcompdist = "normal", gridmult = 2, df = NULL))[1:2]
}

summary(time.em)
summary(time.squarem)
summary(time.ip)

```